!function(){var c={};c.C=typeof JOOSE_CFG!="undefined"?JOOSE_CFG:{};c.is_IE="\v"=="v";c.is_NodeJS=Boolean(typeof process!="undefined"&&process.pid);c.top=c.is_NodeJS&&global||this;c.stub=function(){return function(){throw new Error("Modules can not be instantiated")}};c.VERSION=({VERSION:"3.50.0"}).VERSION;if(typeof module!="undefined"){module.exports=c}this.Joose=c;c.A={each:function(k,j,h){h=h||this;for(var g=0,f=k.length;g<f;g++){if(j.call(h,k[g],g)===false){return false}}},eachR:function(j,h,g){g=g||this;for(var f=j.length-1;f>=0;f--){if(h.call(g,j[f],f)===false){return false}}},exists:function(j,h){for(var g=0,f=j.length;g<f;g++){if(j[g]==h){return true}}return false},map:function(l,k,j){j=j||this;var h=[];for(var g=0,f=l.length;g<f;g++){h.push(k.call(j,l[g],g))}return h},grep:function(h,g){var f=[];c.A.each(h,function(i){if(g(i)){f.push(i)}});return f},remove:function(h,g){var f=[];c.A.each(h,function(i){if(i!==g){f.push(i)}});return f}};c.S={saneSplit:function(h,f){var g=(h||"").split(f);if(g.length==1&&!g[0]){g.shift()}return g},uppercaseFirst:function(f){return f.substr(0,1).toUpperCase()+f.substr(1,f.length-1)},strToClass:function(f,h){var g=h||c.top;c.A.each(f.split("."),function(i){if(g){g=g[i]}else{return false}});return g}};var e=function(){};c.O={each:function(f,j,h){h=h||this;for(var g in f){if(j.call(h,f[g],g)===false){return false}}if(c.is_IE){return c.A.each(["toString","constructor","hasOwnProperty"],function(i){if(f.hasOwnProperty(i)){return j.call(h,f[i],i)}})}},eachOwn:function(f,h,g){g=g||this;return c.O.each(f,function(j,i){if(f.hasOwnProperty(i)){return h.call(g,j,i)}},g)},copy:function(f,g){g=g||{};c.O.each(f,function(i,h){g[h]=i});return g},copyOwn:function(f,g){g=g||{};c.O.eachOwn(f,function(i,h){g[h]=i});return g},getMutableCopy:function(f){e.prototype=f;return new e()},extend:function(g,f){return c.O.copy(f,g)},isEmpty:function(f){for(var g in f){if(f.hasOwnProperty(g)){return false}}return true},isInstance:function(f){return f&&f.meta&&f.constructor==f.meta.c},isClass:function(f){return f&&f.meta&&f.meta.c==f},wantArray:function(f){if(f instanceof Array){return f}return[f]},isFunction:function(f){return typeof f=="function"&&f.constructor!=/ /.constructor}};c.I={Array:function(){return[]},Object:function(){return{}},Function:function(){return arguments.callee},Now:function(){return new Date()}};c.Proto=c.stub();c.Proto.Empty=c.stub();c.Proto.Empty.meta={};(function(){c.Proto.Object=c.stub();var f=function(){var h=f.caller;if(h==g){h=h.caller}if(!h.SUPER){throw"Invalid call to SUPER"}return h.SUPER[h.methodName].apply(this,arguments)};var g=function(){return this.SUPER.apply(this,arguments[0])};c.Proto.Object.prototype={SUPERARG:g,SUPER:f,INNER:function(){throw"Invalid call to INNER"},BUILD:function(h){return arguments.length==1&&typeof h=="object"&&h||{}},initialize:function(){},toString:function(){return"a "+this.meta.name}};c.Proto.Object.meta={constructor:c.Proto.Object,methods:c.O.copy(c.Proto.Object.prototype),attributes:{}};c.Proto.Object.prototype.meta=c.Proto.Object.meta})();(function(){c.Proto.Class=function(){return this.initialize(this.BUILD.apply(this,arguments))||this};var f={VERSION:null,AUTHORITY:null,constructor:c.Proto.Class,superClass:null,name:null,attributes:null,methods:null,meta:null,c:null,defaultSuperClass:c.Proto.Object,BUILD:function(g,h){this.name=g;return{__extend__:h||{}}},initialize:function(g){var h=g.__extend__;this.VERSION=h.VERSION;this.AUTHORITY=h.AUTHORITY;delete h.VERSION;delete h.AUTHORITY;this.c=this.extractConstructor(h);this.adaptConstructor(this.c);if(h.constructorOnly){delete h.constructorOnly;return}this.construct(h)},construct:function(h){if(!this.prepareProps(h)){return}var g=this.superClass=this.extractSuperClass(h);this.processSuperClass(g);this.adaptPrototype(this.c.prototype);this.finalize(h)},finalize:function(g){this.processStem(g);this.extend(g)},prepareProps:function(g){return true},extractConstructor:function(h){var g=h.hasOwnProperty("constructor")?h.constructor:this.defaultConstructor();delete h.constructor;return g},extractSuperClass:function(h){if(h.hasOwnProperty("isa")&&!h.isa){throw new Error("Attempt to inherit from undefined superclass ["+this.name+"]")}var g=h.isa||this.defaultSuperClass;delete h.isa;return g},processStem:function(){var g=this.superClass.meta;this.methods=c.O.getMutableCopy(g.methods||{});this.attributes=c.O.getMutableCopy(g.attributes||{})},initInstance:function(g,h){c.O.copyOwn(h,g)},defaultConstructor:function(){return function(g){var j=this.BUILD;var h=j&&j.apply(this,arguments)||g||{};var i=this.meta;i.initInstance(this,h);return i.hasMethod("initialize")&&this.initialize(h)||this}},processSuperClass:function(h){var g=h.prototype;if(!h.meta){var j=c.O.copy(g);j.isa=c.Proto.Empty;delete j.constructor;var i=new this.defaultSuperClass.meta.constructor(null,j);h.meta=g.meta=i;i.c=h}this.c.prototype=c.O.getMutableCopy(g);this.c.superClass=g},adaptConstructor:function(g){g.meta=this;if(!g.hasOwnProperty("toString")){g.toString=function(){return this.meta.name}}},adaptPrototype:function(g){g.constructor=this.c;g.meta=this},addMethod:function(g,h){h.SUPER=this.superClass.prototype;h.methodName=g;this.methods[g]=h;this.c.prototype[g]=h},addAttribute:function(g,h){this.attributes[g]=h;this.c.prototype[g]=h},removeMethod:function(g){delete this.methods[g];delete this.c.prototype[g]},removeAttribute:function(g){delete this.attributes[g];delete this.c.prototype[g]},hasMethod:function(g){return Boolean(this.methods[g])},hasAttribute:function(g){return this.attributes[g]!==undefined},hasOwnMethod:function(g){return this.hasMethod(g)&&this.methods.hasOwnProperty(g)},hasOwnAttribute:function(g){return this.hasAttribute(g)&&this.attributes.hasOwnProperty(g)},extend:function(g){c.O.eachOwn(g,function(i,h){if(h!="meta"&&h!="constructor"){if(c.O.isFunction(i)&&!i.meta){this.addMethod(h,i)}else{this.addAttribute(h,i)}}},this)},subClassOf:function(g,h){return this.subClass(h,null,g)},subClass:function(i,g,h){i=i||{};i.isa=h||this.c;return new this.constructor(g,i).c},instantiate:function(){var g=function(){};g.prototype=this.c.prototype;var h=new g();return this.c.apply(h,arguments)||h}};c.Proto.Class.prototype=c.O.getMutableCopy(c.Proto.Object.prototype);c.O.extend(c.Proto.Class.prototype,f);c.Proto.Class.prototype.meta=new c.Proto.Class("Joose.Proto.Class",f);c.Proto.Class.meta.addMethod("isa",function(g){var h=function(){};h.prototype=this.c.prototype;return new h() instanceof g})})();c.Managed=c.stub();c.Managed.Property=new c.Proto.Class("Joose.Managed.Property",{name:null,init:null,value:null,definedIn:null,initialize:function(f){c.Managed.Property.superClass.initialize.call(this,f);this.computeValue()},computeValue:function(){this.value=this.init},preApply:function(f){},postUnApply:function(f){},apply:function(f){f[this.name]=this.value},isAppliedTo:function(f){return f[this.name]==this.value},unapply:function(f){if(!this.isAppliedTo(f)){throw"Unapply of property ["+this.name+"] from ["+f+"] failed"}delete f[this.name]},cloneProps:function(){return{name:this.name,init:this.init,definedIn:this.definedIn}},clone:function(f){var g=this.cloneProps();g.name=f||g.name;return new this.constructor(g)}}).c;c.Managed.Property.ConflictMarker=new c.Proto.Class("Joose.Managed.Property.ConflictMarker",{isa:c.Managed.Property,apply:function(f){throw new Error("Attempt to apply ConflictMarker ["+this.name+"] to ["+f+"]")}}).c;c.Managed.Property.Requirement=new c.Proto.Class("Joose.Managed.Property.Requirement",{isa:c.Managed.Property,apply:function(f){if(!f.meta.hasMethod(this.name)){throw new Error("Requirement ["+this.name+"], defined in ["+this.definedIn.definedIn.name+"] is not satisfied for class ["+f+"]")}},unapply:function(f){}}).c;c.Managed.Property.Attribute=new c.Proto.Class("Joose.Managed.Property.Attribute",{isa:c.Managed.Property,slot:null,initialize:function(){c.Managed.Property.Attribute.superClass.initialize.apply(this,arguments);this.slot=this.name},apply:function(f){f.prototype[this.slot]=this.value},isAppliedTo:function(f){return f.prototype[this.slot]==this.value},unapply:function(f){if(!this.isAppliedTo(f)){throw"Unapply of property ["+this.name+"] from ["+f+"] failed"}delete f.prototype[this.slot]},clearValue:function(f){delete f[this.slot]},hasValue:function(f){return f.hasOwnProperty(this.slot)},getRawValueFrom:function(f){return f[this.slot]},setRawValueTo:function(f,g){f[this.slot]=g;return this}}).c;c.Managed.Property.MethodModifier=new c.Proto.Class("Joose.Managed.Property.MethodModifier",{isa:c.Managed.Property,prepareWrapper:function(){throw"Abstract method [prepareWrapper] of "+this+" was called"},apply:function(m){var f=this.name;var j=m.prototype;var l=j.hasOwnProperty(f);var h=j[f];var g=m.meta.superClass.prototype;var i=l?h:function(){return g[f].apply(this,arguments)};var k=this.prepareWrapper({name:f,modifier:this.value,isOwn:l,originalCall:i,superProto:g,target:m});if(l){k.__ORIGINAL__=h}k.__CONTAIN__=this.value;k.__METHOD__=this;j[f]=k},isAppliedTo:function(g){var f=g.prototype[this.name];return f&&f.__CONTAIN__==this.value},unapply:function(i){var f=this.name;var h=i.prototype;var g=h[f].__ORIGINAL__;if(!this.isAppliedTo(i)){throw"Unapply of method ["+f+"] from class ["+i+"] failed"}if(g){h[f]=g}else{delete h[f]}}}).c;c.Managed.Property.MethodModifier.Override=new c.Proto.Class("Joose.Managed.Property.MethodModifier.Override",{isa:c.Managed.Property.MethodModifier,prepareWrapper:function(m){var f=m.modifier;var l=m.originalCall;var k=m.superProto;var h=k.meta.constructor;var g=(h==c.Proto.Class||h==c.Proto.Object)&&!(m.isOwn&&l.IS_OVERRIDE);var j=l;if(g){j=function(){var n=this.SUPER;this.SUPER=k.SUPER;var o=l.apply(this,arguments);this.SUPER=n;return o}}var i=function(){var n=this.SUPER;this.SUPER=j;var o=f.apply(this,arguments);this.SUPER=n;return o};i.IS_OVERRIDE=true;return i}}).c;c.Managed.Property.MethodModifier.Put=new c.Proto.Class("Joose.Managed.Property.MethodModifier.Put",{isa:c.Managed.Property.MethodModifier.Override,prepareWrapper:function(f){if(f.isOwn){throw"Method ["+f.name+"] is applying over something ["+f.originalCall+"] in class ["+f.target+"]"}return c.Managed.Property.MethodModifier.Put.superClass.prepareWrapper.call(this,f)}}).c;c.Managed.Property.MethodModifier.After=new c.Proto.Class("Joose.Managed.Property.MethodModifier.After",{isa:c.Managed.Property.MethodModifier,prepareWrapper:function(h){var f=h.modifier;var g=h.originalCall;return function(){var i=g.apply(this,arguments);f.apply(this,arguments);return i}}}).c;c.Managed.Property.MethodModifier.Before=new c.Proto.Class("Joose.Managed.Property.MethodModifier.Before",{isa:c.Managed.Property.MethodModifier,prepareWrapper:function(h){var f=h.modifier;var g=h.originalCall;return function(){f.apply(this,arguments);return g.apply(this,arguments)}}}).c;c.Managed.Property.MethodModifier.Around=new c.Proto.Class("Joose.Managed.Property.MethodModifier.Around",{isa:c.Managed.Property.MethodModifier,prepareWrapper:function(j){var f=j.modifier;var h=j.originalCall;var i;var g=function(){return h.apply(i,arguments)};return function(){i=this;var k=[g];k.push.apply(k,arguments);return f.apply(this,k)}}}).c;c.Managed.Property.MethodModifier.Augment=new c.Proto.Class("Joose.Managed.Property.MethodModifier.Augment",{isa:c.Managed.Property.MethodModifier,prepareWrapper:function(g){var f=function(){var k=[];var h=f;do{k.push(h.IS_AUGMENT?h.__CONTAIN__:h);h=h.IS_AUGMENT&&(h.__ORIGINAL__||h.SUPER[h.methodName])}while(h);var j=this.INNER;this.INNER=function(){var l=k.pop();return l?l.apply(this,arguments):undefined};var i=this.INNER.apply(this,arguments);this.INNER=j;return i};f.methodName=g.name;f.SUPER=g.superProto;f.IS_AUGMENT=true;return f}}).c;c.Managed.PropertySet=new c.Proto.Class("Joose.Managed.PropertySet",{isa:c.Managed.Property,properties:null,propertyMetaClass:c.Managed.Property,initialize:function(f){c.Managed.PropertySet.superClass.initialize.call(this,f);this.properties=f.properties||{}},addProperty:function(g,h){var f=h.meta||this.propertyMetaClass;delete h.meta;h.definedIn=this;h.name=g;return this.properties[g]=new f(h)},addPropertyObject:function(f){return this.properties[f.name]=f},removeProperty:function(f){var g=this.properties[f];delete this.properties[f];return g},haveProperty:function(f){return this.properties[f]!=null},haveOwnProperty:function(f){return this.haveProperty(f)&&this.properties.hasOwnProperty(f)},getProperty:function(f){return this.properties[f]},each:function(g,f){c.O.each(this.properties,g,f||this)},eachOwn:function(g,f){c.O.eachOwn(this.properties,g,f||this)},eachAll:function(g,f){this.each(g,f)},cloneProps:function(){var f=c.Managed.PropertySet.superClass.cloneProps.call(this);f.propertyMetaClass=this.propertyMetaClass;return f},clone:function(f){var g=this.cleanClone(f);g.properties=c.O.copyOwn(this.properties);return g},cleanClone:function(f){var g=this.cloneProps();g.name=f||g.name;return new this.constructor(g)},alias:function(g){var f=this.properties;c.O.each(g,function(i,h){var j=f[h];if(j){this.addPropertyObject(j.clone(i))}},this)},exclude:function(g){var f=this.properties;c.A.each(g,function(h){delete f[h]})},beforeConsumedBy:function(){},flattenTo:function(g){var f=g.properties;this.eachOwn(function(j,i){var h=f[i];if(h instanceof c.Managed.Property.ConflictMarker){return}if(!f.hasOwnProperty(i)||h==null){g.addPropertyObject(j);return}if(h==j){return}g.removeProperty(i);g.addProperty(i,{meta:c.Managed.Property.ConflictMarker})},this)},composeTo:function(f){this.eachOwn(function(h,g){if(!f.haveOwnProperty(g)){f.addPropertyObject(h)}})},composeFrom:function(){if(!arguments.length){return}var f=this.cleanClone();c.A.each(arguments,function(g){var i=!(g instanceof c.Managed.PropertySet);var h=i?g.propertySet:g;h.beforeConsumedBy(this,f);if(i){if(g.alias||g.exclude){h=h.clone()}if(g.alias){h.alias(g.alias)}if(g.exclude){h.exclude(g.exclude)}}h.flattenTo(f)},this);f.composeTo(this)},preApply:function(f){this.eachOwn(function(g){g.preApply(f)})},apply:function(f){this.eachOwn(function(g){g.apply(f)})},unapply:function(f){this.eachOwn(function(g){g.unapply(f)})},postUnApply:function(f){this.eachOwn(function(g){g.postUnApply(f)})}}).c;var b=1;c.Managed.PropertySet.Mutable=new c.Proto.Class("Joose.Managed.PropertySet.Mutable",{isa:c.Managed.PropertySet,ID:null,derivatives:null,opened:null,composedFrom:null,initialize:function(f){c.Managed.PropertySet.Mutable.superClass.initialize.call(this,f);this.opened=1;this.derivatives={};this.ID=b++;this.composedFrom=[]},addComposeInfo:function(){this.ensureOpen();c.A.each(arguments,function(f){this.composedFrom.push(f);var g=f instanceof c.Managed.PropertySet?f:f.propertySet;g.derivatives[this.ID]=this},this)},removeComposeInfo:function(){this.ensureOpen();c.A.each(arguments,function(f){var h=0;while(h<this.composedFrom.length){var g=this.composedFrom[h];g=g instanceof c.Managed.PropertySet?g:g.propertySet;if(f==g){delete g.derivatives[this.ID];this.composedFrom.splice(h,1)}else{h++}}},this)},ensureOpen:function(){if(!this.opened){throw"Mutation of closed property set: ["+this.name+"]"}},addProperty:function(f,g){this.ensureOpen();return c.Managed.PropertySet.Mutable.superClass.addProperty.call(this,f,g)},addPropertyObject:function(f){this.ensureOpen();return c.Managed.PropertySet.Mutable.superClass.addPropertyObject.call(this,f)},removeProperty:function(f){this.ensureOpen();return c.Managed.PropertySet.Mutable.superClass.removeProperty.call(this,f)},composeFrom:function(){this.ensureOpen();return c.Managed.PropertySet.Mutable.superClass.composeFrom.apply(this,this.composedFrom)},open:function(){this.opened++;if(this.opened==1){c.O.each(this.derivatives,function(f){f.open()});this.deCompose()}},close:function(){if(!this.opened){throw"Unmatched 'close' operation on property set: ["+this.name+"]"}if(this.opened==1){this.reCompose();c.O.each(this.derivatives,function(f){f.close()})}this.opened--},reCompose:function(){this.composeFrom()},deCompose:function(){this.eachOwn(function(g,f){if(g.definedIn!=this){this.removeProperty(f)}},this)}}).c;c.Managed.StemElement=function(){throw"Modules may not be instantiated."};c.Managed.StemElement.Attributes=new c.Proto.Class("Joose.Managed.StemElement.Attributes",{isa:c.Managed.PropertySet.Mutable,propertyMetaClass:c.Managed.Property.Attribute}).c;c.Managed.StemElement.Methods=new c.Proto.Class("Joose.Managed.StemElement.Methods",{isa:c.Managed.PropertySet.Mutable,propertyMetaClass:c.Managed.Property.MethodModifier.Put,preApply:function(){},postUnApply:function(){}}).c;c.Managed.StemElement.Requirements=new c.Proto.Class("Joose.Managed.StemElement.Requirements",{isa:c.Managed.PropertySet.Mutable,propertyMetaClass:c.Managed.Property.Requirement,alias:function(){},exclude:function(){},flattenTo:function(f){this.each(function(h,g){if(!f.haveProperty(g)){f.addPropertyObject(h)}})},composeTo:function(f){this.flattenTo(f)},preApply:function(){},postUnApply:function(){}}).c;c.Managed.StemElement.MethodModifiers=new c.Proto.Class("Joose.Managed.StemElement.MethodModifiers",{isa:c.Managed.PropertySet.Mutable,propertyMetaClass:null,addProperty:function(h,j){var g=j.meta;delete j.meta;j.definedIn=this;j.name=h;var f=new g(j);var i=this.properties;if(!i[h]){i[h]=[]}i[h].push(f);return f},addPropertyObject:function(g){var f=g.name;var h=this.properties;if(!h[f]){h[f]=[]}h[f].push(g);return g},removeProperty:function(g){if(!this.haveProperty(g)){return undefined}var h=this.properties;var f=h[g].pop();if(!h[g].length){c.Managed.StemElement.MethodModifiers.superClass.removeProperty.call(this,g)}return f},alias:function(){},exclude:function(){},flattenTo:function(g){var f=g.properties;this.each(function(h,i){var j=f[i];if(j==null){j=f[i]=[]}c.A.each(h,function(k){if(!c.A.exists(j,k)){j.push(k)}})})},composeTo:function(f){this.flattenTo(f)},deCompose:function(){this.each(function(f,g){var h=0;while(h<f.length){if(f[h].definedIn!=this){f.splice(h,1)}else{h++}}})},preApply:function(f){},postUnApply:function(f){},apply:function(f){this.each(function(g,h){c.A.each(g,function(i){i.apply(f)})})},unapply:function(f){this.each(function(g,h){for(var j=g.length-1;j>=0;j--){g[j].unapply(f)}})}}).c;c.Managed.PropertySet.Composition=new c.Proto.Class("Joose.Managed.PropertySet.Composition",{isa:c.Managed.PropertySet.Mutable,propertyMetaClass:c.Managed.PropertySet.Mutable,processOrder:null,each:function(h,g){var f=this.properties;var g=g||this;c.A.each(this.processOrder,function(i){h.call(g,f[i],i)})},eachR:function(h,g){var f=this.properties;var g=g||this;c.A.eachR(this.processOrder,function(i){h.call(g,f[i],i)})},clone:function(f){var g=this.cleanClone(f);this.each(function(h){g.addPropertyObject(h.clone())});return g},alias:function(f){this.each(function(g){g.alias(f)})},exclude:function(f){this.each(function(g){g.exclude(f)})},flattenTo:function(g){var f=g.properties;this.each(function(j,h){var i=f[h]||g.addProperty(h,{meta:j.constructor});j.flattenTo(i)})},composeTo:function(g){var f=g.properties;this.each(function(j,h){var i=f[h]||g.addProperty(h,{meta:j.constructor});j.composeTo(i)})},deCompose:function(){this.eachR(function(f){f.open()});c.Managed.PropertySet.Composition.superClass.deCompose.call(this)},reCompose:function(){c.Managed.PropertySet.Composition.superClass.reCompose.call(this);this.each(function(f){f.close()})},unapply:function(f){this.eachR(function(g){g.unapply(f)})}}).c;c.Managed.Stem=new c.Proto.Class("Joose.Managed.Stem",{isa:c.Managed.PropertySet.Composition,targetMeta:null,attributesMC:c.Managed.StemElement.Attributes,methodsMC:c.Managed.StemElement.Methods,requirementsMC:c.Managed.StemElement.Requirements,methodsModifiersMC:c.Managed.StemElement.MethodModifiers,processOrder:["attributes","methods","requirements","methodsModifiers"],initialize:function(f){c.Managed.Stem.superClass.initialize.call(this,f);var g=this.targetMeta;this.addProperty("attributes",{meta:this.attributesMC,properties:g?g.attributes:{}});this.addProperty("methods",{meta:this.methodsMC,properties:g?g.methods:{}});this.addProperty("requirements",{meta:this.requirementsMC});this.addProperty("methodsModifiers",{meta:this.methodsModifiersMC})},reCompose:function(){var f=this.targetMeta.c;this.preApply(f);c.Managed.Stem.superClass.reCompose.call(this);this.apply(f)},deCompose:function(){var f=this.targetMeta.c;this.unapply(f);c.Managed.Stem.superClass.deCompose.call(this);this.postUnApply(f)}}).c;c.Managed.Builder=new c.Proto.Class("Joose.Managed.Builder",{targetMeta:null,_buildStart:function(g,f){g.stem.open();c.A.each(["trait","traits","removeTrait","removeTraits","does","doesnot","doesnt"],function(h){if(f[h]){this[h](g,f[h]);delete f[h]}},this)},_extend:function(f){if(c.O.isEmpty(f)){return}var g=this.targetMeta;this._buildStart(g,f);c.O.eachOwn(f,function(j,h){var i=this[h];if(!i){throw new Error("Unknown builder ["+h+"] was used during extending of ["+g.c+"]")}i.call(this,g,j)},this);this._buildComplete(g,f)},_buildComplete:function(g,f){g.stem.close()},methods:function(g,f){c.O.eachOwn(f,function(i,h){g.addMethod(h,i)})},removeMethods:function(g,f){c.A.each(f,function(h){g.removeMethod(h)})},have:function(g,f){c.O.eachOwn(f,function(i,h){g.addAttribute(h,i)})},havenot:function(g,f){c.A.each(f,function(h){g.removeAttribute(h)})},havent:function(g,f){this.havenot(g,f)},after:function(g,f){c.O.each(f,function(i,h){g.addMethodModifier(h,i,c.Managed.Property.MethodModifier.After)})},before:function(g,f){c.O.each(f,function(i,h){g.addMethodModifier(h,i,c.Managed.Property.MethodModifier.Before)})},override:function(g,f){c.O.each(f,function(i,h){g.addMethodModifier(h,i,c.Managed.Property.MethodModifier.Override)})},around:function(g,f){c.O.each(f,function(i,h){g.addMethodModifier(h,i,c.Managed.Property.MethodModifier.Around)})},augment:function(g,f){c.O.each(f,function(i,h){g.addMethodModifier(h,i,c.Managed.Property.MethodModifier.Augment)})},removeModifier:function(g,f){c.A.each(f,function(h){g.removeMethodModifier(h)})},does:function(g,f){c.A.each(c.O.wantArray(f),function(h){g.addRole(h)})},doesnot:function(g,f){c.A.each(c.O.wantArray(f),function(h){g.removeRole(h)})},doesnt:function(g,f){this.doesnot(g,f)},trait:function(){this.traits.apply(this,arguments)},traits:function(g,f){if(g.firstPass){return}if(!g.meta.isDetached){throw"Can't apply trait to not detached class"}g.meta.extend({does:f})},removeTrait:function(){this.removeTraits.apply(this,arguments)},removeTraits:function(g,f){if(!g.meta.isDetached){throw"Can't remove trait from not detached class"}g.meta.extend({doesnot:f})}}).c;c.Managed.Class=new c.Proto.Class("Joose.Managed.Class",{isa:c.Proto.Class,stem:null,stemClass:c.Managed.Stem,stemClassCreated:false,builder:null,builderClass:c.Managed.Builder,builderClassCreated:false,isDetached:false,firstPass:true,skipTraitsAnchor:{},BUILD:function(){var f=c.Managed.Class.superClass.BUILD.apply(this,arguments);var g=f.__extend__;var h=c.O.wantArray(g.trait||g.traits||[]);delete g.trait;delete g.traits;c.A.each(c.O.wantArray(g.does||[]),function(i){var j=(i.meta instanceof c.Managed.Class)?i:i.role;if(j.meta.meta.isDetached){h.push(j.meta.constructor)}});if(h.length){g.traits=h}return f},initInstance:function(f,g){c.O.each(this.attributes,function(i,h){if(i instanceof c.Managed.Attribute){i.initFromConfig(f,g)}else{if(g.hasOwnProperty(h)){f[h]=g[h]}}})},defaultConstructor:function(){return function(g,i){var f=this.meta;var k=g==f.skipTraitsAnchor;var j=this.BUILD;var m=j&&j.apply(this,k?i:arguments)||(k?i[0]:g)||{};var l=m.__extend__||m;var n=l.trait||l.traits;if(n||l.detached){delete l.trait;delete l.traits;delete l.detached;if(!k){var h=f.subClass({does:n||[]},f.name);var o=h.meta;o.isDetached=true;return o.instantiate(f.skipTraitsAnchor,arguments)}}f.initInstance(this,m);return f.hasMethod("initialize")&&this.initialize(m)||this}},finalize:function(f){c.Managed.Class.superClass.finalize.call(this,f);this.stem.close();this.afterMutate()},processStem:function(){c.Managed.Class.superClass.processStem.call(this);this.builder=new this.builderClass({targetMeta:this});this.stem=new this.stemClass({name:this.name,targetMeta:this});var g=this.getClassInAttribute("builderClass");if(g){this.builderClassCreated=true;this.addAttribute("builderClass",this.subClassOf(g))}var f=this.getClassInAttribute("stemClass");if(f){this.stemClassCreated=true;this.addAttribute("stemClass",this.subClassOf(f))}},extend:function(f){if(f.builder){this.getBuilderTarget().meta.extend(f.builder);delete f.builder}if(f.stem){this.getStemTarget().meta.extend(f.stem);delete f.stem}this.builder._extend(f);this.firstPass=false;if(!this.stem.opened){this.afterMutate()}},getBuilderTarget:function(){var f=this.getClassInAttribute("builderClass");if(!f){throw"Attempt to extend a builder on non-meta class"}return f},getStemTarget:function(){var f=this.getClassInAttribute("stemClass");if(!f){throw"Attempt to extend a stem on non-meta class"}return f},getClassInAttribute:function(f){var g=this.getAttribute(f);if(g instanceof c.Managed.Property.Attribute){g=g.value}return g},addMethodModifier:function(f,i,h){var g={};g.init=i;g.meta=h;return this.stem.properties.methodsModifiers.addProperty(f,g)},removeMethodModifier:function(f){return this.stem.properties.methodsModifiers.removeProperty(f)},addMethod:function(f,h,g){g=g||{};g.init=h;return this.stem.properties.methods.addProperty(f,g)},addAttribute:function(f,h,g){g=g||{};g.init=h;return this.stem.properties.attributes.addProperty(f,g)},removeMethod:function(f){return this.stem.properties.methods.removeProperty(f)},removeAttribute:function(f){return this.stem.properties.attributes.removeProperty(f)},hasMethod:function(f){return this.stem.properties.methods.haveProperty(f)},hasAttribute:function(f){return this.stem.properties.attributes.haveProperty(f)},hasMethodModifiersFor:function(f){return this.stem.properties.methodsModifiers.haveProperty(f)},hasOwnMethod:function(f){return this.stem.properties.methods.haveOwnProperty(f)},hasOwnAttribute:function(f){return this.stem.properties.attributes.haveOwnProperty(f)},getMethod:function(f){return this.stem.properties.methods.getProperty(f)},getAttribute:function(f){return this.stem.properties.attributes.getProperty(f)},eachRole:function(g,h,f){c.A.each(g,function(i,j){var k=(i.meta instanceof c.Managed.Class)?i:i.role;h.call(f||this,i,k,j)},this)},addRole:function(){this.eachRole(arguments,function(f,h){this.beforeRoleAdd(h);var g=f;if(h!=f){g.propertySet=h.meta.stem;delete g.role}else{g=g.meta.stem}this.stem.addComposeInfo(g)},this)},beforeRoleAdd:function(g){var f=g.meta;if(f.builderClassCreated){this.getBuilderTarget().meta.extend({does:[f.getBuilderTarget()]})}if(f.stemClassCreated){this.getStemTarget().meta.extend({does:[f.getStemTarget()]})}if(f.meta.isDetached&&!this.firstPass){this.builder.traits(this,f.constructor)}},beforeRoleRemove:function(g){var f=g.meta;if(f.builderClassCreated){this.getBuilderTarget().meta.extend({doesnt:[f.getBuilderTarget()]})}if(f.stemClassCreated){this.getStemTarget().meta.extend({doesnt:[f.getStemTarget()]})}if(f.meta.isDetached&&!this.firstPass){this.builder.removeTraits(this,f.constructor)}},removeRole:function(){this.eachRole(arguments,function(f,g){this.beforeRoleRemove(g);this.stem.removeComposeInfo(g.meta.stem)},this)},getRoles:function(){return c.A.map(this.stem.composedFrom,function(f){if(!(f instanceof c.Managed.PropertySet)){return f.propertySet}return f.targetMeta.c})},does:function(j){var g=this.getRoles();for(var h=0;h<g.length;h++){if(j==g[h]){return true}}for(var h=0;h<g.length;h++){if(g[h].meta.does(j)){return true}}var f=this.superClass.meta;if(this.superClass!=c.Proto.Empty&&f&&f.meta&&f.meta.hasMethod("does")){return f.does(j)}return false},getMethods:function(){return this.stem.properties.methods},getAttributes:function(){return this.stem.properties.attributes},afterMutate:function(){},getCurrentMethod:function(){for(var g=arguments.callee.caller,f=0;g&&f<5;g=g.caller,f++){if(g.__METHOD__){return g.__METHOD__}}return null}}).c;c.Managed.Role=new c.Managed.Class("Joose.Managed.Role",{isa:c.Managed.Class,have:{defaultSuperClass:c.Proto.Empty,builderRole:null,stemRole:null},methods:{defaultConstructor:function(){return function(){throw new Error("Roles cant be instantiated")}},processSuperClass:function(){if(this.superClass!=this.defaultSuperClass){throw new Error("Roles can't inherit from anything")}},getBuilderTarget:function(){if(!this.builderRole){this.builderRole=new this.constructor().c;this.builderClassCreated=true}return this.builderRole},getStemTarget:function(){if(!this.stemRole){this.stemRole=new this.constructor().c;this.stemClassCreated=true}return this.stemRole},addRequirement:function(f){this.stem.properties.requirements.addProperty(f,{})}},stem:{methods:{apply:function(){},unapply:function(){}}},builder:{methods:{requires:function(f,g){c.A.each(c.O.wantArray(g),function(h){f.addRequirement(h)},this)}}}}).c;c.Managed.Attribute=new c.Managed.Class("Joose.Managed.Attribute",{isa:c.Managed.Property.Attribute,have:{is:null,builder:null,isPrivate:false,role:null,publicName:null,setterName:null,getterName:null,readable:false,writeable:false,hasGetter:false,hasSetter:false,required:false,canInlineSetRaw:true,canInlineGetRaw:true},after:{initialize:function(){var f=this.name;this.publicName=f.replace(/^_+/,"");this.slot=this.isPrivate?"$$"+f:f;this.setterName=this.setterName||this.getSetterName();this.getterName=this.getterName||this.getGetterName();this.readable=this.hasGetter=/^r/i.test(this.is);this.writeable=this.hasSetter=/^.w/i.test(this.is)}},override:{computeValue:function(){var f=this.init;if(c.O.isClass(f)||!c.O.isFunction(f)){this.SUPER()}},preApply:function(f){f.meta.extend({methods:this.getAccessorsFor(f)})},postUnApply:function(f){f.meta.extend({removeMethods:this.getAccessorsFrom(f)})}},methods:{getAccessorsFor:function(i){var j=i.meta;var g=this.setterName;var h=this.getterName;var f={};if(this.hasSetter&&!j.hasMethod(g)){f[g]=this.getSetter();f[g].ACCESSOR_FROM=this}if(this.hasGetter&&!j.hasMethod(h)){f[h]=this.getGetter();f[h].ACCESSOR_FROM=this}return f},getAccessorsFrom:function(l){var k=l.meta;var h=this.setterName;var i=this.getterName;var j=this.hasSetter&&k.getMethod(h);var g=this.hasGetter&&k.getMethod(i);var f=[];if(j&&j.value.ACCESSOR_FROM==this){f.push(h)}if(g&&g.value.ACCESSOR_FROM==this){f.push(i)}return f},getGetterName:function(){return"get"+c.S.uppercaseFirst(this.publicName)},getSetterName:function(){return"set"+c.S.uppercaseFirst(this.publicName)},getSetter:function(){var f=this;var g=f.slot;if(f.canInlineSetRaw){return function(h){this[g]=h;return this}}else{return function(){return f.setRawValueTo.apply(this,arguments)}}},getGetter:function(){var f=this;var g=f.slot;if(f.canInlineGetRaw){return function(h){return this[g]}}else{return function(){return f.getRawValueFrom.apply(this,arguments)}}},getValueFrom:function(f){var g=this.getterName;if(this.readable&&f.meta.hasMethod(g)){return f[g]()}return this.getRawValueFrom(f)},setValueTo:function(f,h){var g=this.setterName;if(this.writeable&&f.meta.hasMethod(g)){f[g](h)}else{this.setRawValueTo(f,h)}},initFromConfig:function(f,h){var g=this.name;var j,i=false;if(h.hasOwnProperty(g)){j=h[g];i=true}else{var k=this.init;if(c.O.isFunction(k)&&!c.O.isClass(k)){j=k.call(f,h,g);i=true}else{if(this.builder){j=f[this.builder.replace(/^this\./,"")](h,g);i=true}}}if(i){this.setRawValueTo(f,j)}else{if(this.required){throw new Error("Required attribute ["+g+"] is missed during initialization of "+f)}}}}}).c;c.Managed.Attribute.Builder=new c.Managed.Role("Joose.Managed.Attribute.Builder",{have:{defaultAttributeClass:c.Managed.Attribute},builder:{methods:{has:function(f,g){c.O.eachOwn(g,function(i,h){if(typeof i!="object"||i==null||i.constructor==/ /.constructor){i={init:i}}i.meta=i.meta||f.defaultAttributeClass;if(/^__/.test(h)){h=h.replace(/^_+/,"");i.isPrivate=true}f.addAttribute(h,i.init,i)},this)},hasnot:function(f,g){this.havenot(f,g)},hasnt:function(f,g){this.hasnot(f,g)}}}}).c;c.Managed.My=new c.Managed.Role("Joose.Managed.My",{have:{myClass:null,needToReAlias:false},methods:{createMy:function(l){var i=this.meta;var f=this instanceof c.Managed.Role;var g=l.my||{};delete l.my;var j=this.superClass.meta.myClass;if(!f&&!g.isa&&j){g.isa=j}if(!g.meta&&!g.isa){g.meta=this.constructor}var h=this.myClass=a(g);var k=this.c;k.prototype.my=k.my=f?h:new h({HOST:k});this.needToReAlias=true},aliasStaticMethods:function(){this.needToReAlias=false;var g=this.c;var f=this.myClass.prototype;c.O.eachOwn(g,function(i,h){if(i.IS_ALIAS){delete g[h]}});this.myClass.meta.stem.properties.methods.each(function(i,h){if(!g[h]){(g[h]=function(){return f[h].apply(g.my,arguments)}).IS_ALIAS=true}})}},override:{extend:function(g){var f=this.myClass;if(!f&&this.superClass.meta.myClass){this.createMy(g)}if(g.my){if(!f){this.createMy(g)}else{this.needToReAlias=true;f.meta.extend(g.my);delete g.my}}this.SUPER(g);if(this.needToReAlias&&!(this instanceof c.Managed.Role)){this.aliasStaticMethods()}}},before:{addRole:function(){var f;c.A.each(arguments,function(g){if(!g){throw new Error("Attempt to consume an undefined Role into ["+this.name+"]")}var h=(g.meta instanceof c.Managed.Class)?g:g.role;if(h.meta.meta.hasAttribute("myClass")&&h.meta.myClass){if(!this.myClass){this.createMy({my:{does:h.meta.myClass}});return}f=this.myClass.meta.stem;if(!f.opened){f.open()}f.addComposeInfo(h.my.meta.stem)}},this);if(f){f.close();this.needToReAlias=true}},removeRole:function(){if(!this.myClass){return}var f=this.myClass.meta.stem;f.open();c.A.each(arguments,function(g){if(g.meta.meta.hasAttribute("myClass")&&g.meta.myClass){f.removeComposeInfo(g.my.meta.stem);this.needToReAlias=true}},this);f.close()}}}).c;c.Namespace=c.stub();c.Namespace.Able=new c.Managed.Role("Joose.Namespace.Able",{have:{bodyFunc:null},before:{extend:function(f){if(f.body){this.bodyFunc=f.body;delete f.body}}},after:{afterMutate:function(){var f=this.bodyFunc;delete this.bodyFunc;if(f){c.Namespace.Manager.my.executeIn(this.c,f)}}}}).c;c.Managed.Bootstrap=new c.Managed.Role("Joose.Managed.Bootstrap",{does:[c.Namespace.Able,c.Managed.My,c.Managed.Attribute.Builder]}).c;c.Meta=c.stub();c.Meta.Object=new c.Proto.Class("Joose.Meta.Object",{isa:c.Proto.Object}).c;c.Meta.Class=new c.Managed.Class("Joose.Meta.Class",{isa:c.Managed.Class,does:c.Managed.Bootstrap,have:{defaultSuperClass:c.Meta.Object}}).c;c.Meta.Role=new c.Meta.Class("Joose.Meta.Role",{isa:c.Managed.Role,does:c.Managed.Bootstrap}).c;c.Namespace.Keeper=new c.Meta.Class("Joose.Namespace.Keeper",{isa:c.Meta.Class,have:{externalConstructor:null},methods:{defaultConstructor:function(){return function(){var g=arguments.callee.meta;if(g instanceof c.Namespace.Keeper){throw new Error("Module ["+g.c+"] may not be instantiated. Forgot to 'use' the class with the same name?")}var f=g.externalConstructor;if(typeof f=="function"){f.meta=g;return f.apply(this,arguments)}throw"NamespaceKeeper of ["+g.name+"] was planted incorrectly."}},plant:function(g){var f=this.c;f.meta=g.meta;f.meta.c=f;f.meta.externalConstructor=g}}}).c;c.Namespace.Manager=new c.Managed.Class("Joose.Namespace.Manager",{have:{current:null},methods:{initialize:function(){this.current=[c.top]},getCurrent:function(){return this.current[0]},executeIn:function(g,h){var i=this.current;i.unshift(g);var f=h.call(g,g);i.shift();return f},earlyCreate:function(g,f,h){h.constructorOnly=true;return new f(g,h).c},create:function(h,t,q){if(!h){return new t(h,q).c}var r=this;if(/^\./.test(h)){return this.executeIn(c.top,function(){return r.create(h.replace(/^\./,""),t,q)})}var s=q||{};var l=c.S.saneSplit(h,".");var k=this.getCurrent();var o=k==c.top?[]:c.S.saneSplit(k.meta.name,".");for(var n=0;n<l.length;n++){var g=l[n];var m=n==l.length-1;if(g=="meta"||g=="my"||!g){throw"Module name ["+h+"] may not include a part called 'meta' or 'my' or empty part."}var v=k[g];o.push(g);var f=o.join(".");var j=false;var p;if(typeof v=="undefined"){if(m){p=this.earlyCreate(f,t,s);j=true}else{p=new c.Namespace.Keeper(f).c}k[g]=p;v=p}else{if(m&&v&&v.meta){var u=v.meta;if(t==c.Namespace.Keeper){u.extend(s)}else{if(u instanceof c.Namespace.Keeper){u.plant(this.earlyCreate(f,t,s));j=true}else{throw new Error("Double declaration of ["+f+"]")}}}else{if(m&&!(v&&v.meta&&v.meta.meta)){throw"Trying to setup module "+f+" failed. There is already something: "+v}}}if(m){this.prepareMeta(v.meta)}if(j){v.meta.construct(s)}k=v}return k},prepareMeta:function(){},prepareProperties:function(g,h,f,j){if(g&&typeof g!="string"){h=g;g=null}var i;if(h&&h.meta){i=h.meta;delete h.meta}if(!i){if(h&&typeof h.isa=="function"&&h.isa.meta){i=h.isa.meta.constructor}else{i=f}}return j.call(this,g,i,h)},getDefaultHelperFor:function(f){var g=this;return function(h,i){return g.prepareProperties(h,i,f,function(j,l,k){return g.create(j,l,k)})}},register:function(k,f,j){var i=this;if(this.meta.hasMethod(k)){var h=function(){return i[k].apply(i,arguments)};if(!c.top[k]){c.top[k]=h}if(!c[k]){c[k]=h}if(c.is_NodeJS&&typeof exports!="undefined"){exports[k]=h}}else{var g={};g[k]=j||this.getDefaultHelperFor(f);this.meta.extend({methods:g});this.register(k)}},Module:function(f,g){return this.prepareProperties(f,g,c.Namespace.Keeper,function(h,j,i){if(typeof i=="function"){i={body:i}}return this.create(h,j,i)})}}}).c;c.Namespace.Manager.my=new c.Namespace.Manager();c.Namespace.Manager.my.register("Class",c.Meta.Class);c.Namespace.Manager.my.register("Role",c.Meta.Role);c.Namespace.Manager.my.register("Module");var a=c.Class;var d=c.Role;d("Joose.Attribute.Delegate",{have:{handles:null},override:{eachDelegate:function(f,h,g){if(typeof f=="string"){return h.call(g,f,f)}if(f instanceof Array){return c.A.each(f,function(i){h.call(g,i,i)})}if(f===Object(f)){c.O.eachOwn(f,function(j,i){h.call(g,i,j)})}},getAccessorsFor:function(h){var i=h.meta;var f=this.SUPER(h);var g=this;this.eachDelegate(this.handles,function(j,l){if(!i.hasMethod(j)){var k=f[j]=function(){var m=g.getValueFrom(this);return m[l].apply(m,arguments)};k.ACCESSOR_FROM=g}});return f},getAccessorsFrom:function(i){var f=this.SUPER(i);var g=this;var h=i.meta;this.eachDelegate(this.handles,function(j){var k=h.getMethod(j);if(k&&k.value.ACCESSOR_FROM==g){f.push(j)}});return f}}});d("Joose.Attribute.Trigger",{have:{trigger:null},after:{initialize:function(){if(this.trigger){if(!this.writeable){throw new Error("Can't use `trigger` for read-only attributes")}this.hasSetter=true}}},override:{getSetter:function(){var g=this.SUPER();var f=this.trigger;if(!f){return g}var h=this;var i=c.O.isFunction(h.init)?null:h.init;return function(){var j=h.hasValue(this)?h.getValueFrom(this):i;var k=g.apply(this,arguments);f.call(this,h.getValueFrom(this),j);return k}}}});d("Joose.Attribute.Lazy",{have:{lazy:null},before:{computeValue:function(){if(typeof this.init=="function"&&this.lazy){this.lazy=this.init;delete this.init}}},after:{initialize:function(){if(this.lazy){this.readable=this.hasGetter=true}}},override:{getGetter:function(){var g=this.SUPER();var f=this.lazy;if(!f){return g}var h=this;return function(){if(!h.hasValue(this)){var i=typeof f=="function"?f:this[f.replace(/^this\./,"")];h.setValueTo(this,i.apply(this,arguments))}return g.call(this)}}}});d("Joose.Attribute.Accessor.Combined",{have:{isCombined:false},after:{initialize:function(){this.isCombined=this.isCombined||/..c/i.test(this.is);if(this.isCombined){this.slot="$$"+this.name;this.hasGetter=true;this.hasSetter=false;this.setterName=this.getterName=this.publicName}}},override:{getGetter:function(){var f=this.SUPER();if(!this.isCombined){return f}var h=this.getSetter();var g=this;return function(){if(!arguments.length){if(g.readable){return f.call(this)}throw new Error("Call to getter of unreadable attribute: ["+g.name+"]")}if(g.writeable){return h.apply(this,arguments)}throw new Error("Call to setter of read-only attribute: ["+g.name+"]")}}}});c.Managed.Attribute.meta.extend({does:[c.Attribute.Delegate,c.Attribute.Trigger,c.Attribute.Lazy,c.Attribute.Accessor.Combined]});d("Joose.Meta.Singleton",{has:{forceInstance:c.I.Object,instance:null},override:{defaultConstructor:function(){var g=this;var f=this.SUPER();this.adaptConstructor(f);return function(i,j){if(i==g.forceInstance){return f.apply(this,j)||this}var h=g.instance;if(h){if(g.hasMethod("configure")){h.configure.apply(h,arguments)}}else{g.instance=new g.c(g.forceInstance,arguments)}return g.instance}}}});c.Namespace.Manager.my.register("Singleton",a({isa:c.Meta.Class,meta:c.Meta.Class,does:c.Meta.Singleton}))}();